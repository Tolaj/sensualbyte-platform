{
  "collection": "events_outbox",
  "validator": {
    "$jsonSchema": {
      "bsonType": "object",
      "required": [
        "eventId",
        "type",
        "resourceType",
        "resourceId",
        "processed",
        "createdAt"
      ],
      "properties": {
        "_id": {},
        "eventId": {
          "bsonType": "string"
        },
        "type": {
          "bsonType": "string",
          "enum": [
            "RESOURCE_CHANGED",
            "SECRET_CHANGED",
            "RBAC_CHANGED"
          ]
        },
        "resourceType": {
          "bsonType": "string",
          "enum": [
            "resource",
            "secret",
            "role_binding"
          ]
        },
        "resourceId": {
          "bsonType": "string"
        },
        "payload": {
          "bsonType": [
            "object",
            "null"
          ]
        },
        "processed": {
          "bsonType": "bool"
        },
        "processedAt": {
          "bsonType": [
            "date",
            "null"
          ]
        },
        "lock": {
          "bsonType": [
            "object",
            "null"
          ],
          "properties": {
            "lockedBy": {
              "bsonType": "string"
            },
            "lockedAt": {
              "bsonType": "date"
            },
            "lockExpiresAt": {
              "bsonType": "date"
            }
          }
        },
        "attempts": {
          "bsonType": [
            "int",
            "null"
          ]
        },
        "lastError": {
          "bsonType": [
            "string",
            "null"
          ]
        },
        "updatedAt": {
          "bsonType": [
            "date",
            "null"
          ]
        },
        "createdAt": {
          "bsonType": "date"
        }
      }
    }
  }
}